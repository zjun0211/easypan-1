import{j as A,r as g,k as G,_ as N,ag as k,o as p,c as b,a as s,V as r,P as o,n as j,O as x,S as m,T as R,a9 as H,U as J,bh as Q,bf as W}from"./@vue-57ff52f9.js";import{u as X,b as Y}from"./vue-router-8555237b.js";import{m as Z}from"./js-md5-4754c8f0.js";import{_ as ee}from"./index-ca90e5e8.js";import"./aplayer-585df14e.js";import"./pinia-00fcc55c.js";import"./spark-md5-66a43a5d.js";import"./element-plus-ef3483b5.js";import"./lodash-es-36eb724a.js";import"./@vueuse-7d05ada6.js";import"./@element-plus-b7409ee9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-5d216acc.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-9626137c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-880a26aa.js";import"./vue-cookies-fc2d14d9.js";import"./@highlightjs-b4f50377.js";import"./highlight.js-6845818c.js";import"./axios-4a70c6fc.js";import"./docx-preview-6a55e1c1.js";import"./jszip-057f312d.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-d49914df.js";import"./vue-60347265.js";import"./vue3-pdfjs-749e1b4f.js";import"./pdfjs-dist-dcaaa779.js";import"./dommatrix-b4915c8e.js";import"./web-streams-polyfill-ab743aaf.js";import"./dplayer-d4a41b2a.js";import"./vue-clipboard3-69020072.js";import"./clipboard-0f4a3daa.js";const c=P=>(Q("data-v-405e0208"),P=P(),W(),P),oe={class:"login-body"},se=c(()=>s("div",{class:"bg"},null,-1)),le={class:"login-panel"},ae=c(()=>s("div",{class:"login-title"},"Small云盘",-1)),te=c(()=>s("span",{class:"iconfont icon-account"},null,-1)),re=c(()=>s("span",{class:"iconfont icon-password"},null,-1)),ie={key:1},ne={class:"send-emali-panel"},de=c(()=>s("span",{class:"iconfont icon-checkcode"},null,-1)),ue=c(()=>s("div",null,[s("p",null,"1、在垃圾箱中查找邮箱验证码"),s("p",null,"2、在邮箱中头像->设置->反垃圾->白名单->设置邮件地址白名单"),s("p",null," 3、将邮箱【laoluo@wuhancoder.com】添加到白名单不知道怎么设置？ ")],-1)),ce=c(()=>s("span",{class:"a-link",style:{"font-size":"14px"}},"未收到邮箱验证码？",-1)),pe=c(()=>s("span",{class:"iconfont icon-account"},null,-1)),me=c(()=>s("span",{class:"iconfont icon-password"},null,-1)),fe=c(()=>s("span",{class:"iconfont icon-password"},null,-1)),ve={class:"check-code-panel"},_e=c(()=>s("span",{class:"iconfont icon-checkcode"},null,-1)),ge=["src"],ke={class:"rememberme-panel"},we={class:"no-account"},he={key:0},Ce={key:1},Ve={key:2},ye={class:"check-code-panel"},be=c(()=>s("span",{class:"iconfont icon-checkcode"},null,-1)),xe=["src"],Pe={__name:"Login",setup(P){const{proxy:u}=A(),L=X(),$=Y(),f={checkCode:"/api/checkCode",sendMailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"/resetPwd",qqlogin:"/qqlogin"},l=g(),v=i=>{l.value=i,F()};G(()=>{v(1)});const U=g(f.checkCode),I=g(f.checkCode),w=i=>{i==0?U.value=f.checkCode+"?type="+i+"&time="+new Date().getTime():I.value=f.checkCode+"?type="+i+"&time="+new Date().getTime()},C=g({}),q=g(),h=N({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{E()}}]}),T=()=>{M.value.validateField("email",i=>{i&&(h.show=!0,j(()=>{w(1),q.value.resetFields(),C.value={email:t.value.email}}))})},E=()=>{q.value.validate(async i=>{if(!i)return;const e=Object.assign({},C.value);e.type=l.value==0?0:1,await u.Request({url:f.sendMailCode,params:e,errorCallback:()=>{w(1)}})&&(u.Message.success("验证码发送成功，请登录邮箱查看"),h.show=!1)})},V=N({show:!1,title:"标题"}),B=(i,e,n)=>{e!==t.value.registerPassword?n(new Error(i.message)):n()},t=g({}),M=g(),S={email:[{required:!0,message:"请输入邮箱"},{validator:u.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:u.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:B,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},F=()=>{V.show=!0,l.value==0?V.title="注册":l.value==1?V.title="登录":l.value==2&&(V.title="重置密码"),j(()=>{if(w(0),M.value.resetFields(),t.value={},l.value==1){const i=u.VueCookies.get("loginInfo");i&&(t.value=i)}})},z=()=>{M.value.validate(async i=>{if(!i)return;let e={};if(Object.assign(e,t.value),(l.value==0||l.value==2)&&(e.password=e.registerPassword,delete e.registerPassword,delete e.reRegisterPassword),l.value==1){let _=u.VueCookies.get("loginInfo"),y=_==null?null:_.password;e.password!==y&&(e.password=Z(e.password))}let n=null;l.value==0?n=f.register:l.value==1?n=f.login:l.value==2&&(n=f.resetPwd);let d=await u.Request({url:n,params:e,errorCallback:()=>{w(0)}});if(d)if(l.value==0)u.Message.success("注册成功,请登录"),v(1);else if(l.value==1){if(e.rememberMe){const y={email:e.email,password:e.password,rememberMe:e.rememberMe};u.VueCookies.set("loginInfo",y,"7d")}else u.VueCookies.remove("loginInfo");V.show=!1,u.Message.success("登录成功"),u.VueCookies.set("userInfo",d.data,0);const _=$.query.redirectUrl||"/";L.push(_)}else l.value==2&&(u.Message.success("重置密码成功,请登录"),v(1))})};return(i,e)=>{const n=k("el-input"),d=k("el-form-item"),_=k("el-button"),y=k("el-popover"),K=k("el-checkbox"),D=k("el-form"),O=k("Dialog");return p(),b("div",oe,[se,s("div",le,[r(D,{class:"login-register",model:t.value,rules:S,ref_key:"formDataRef",ref:M},{default:o(()=>[ae,r(d,{prop:"email"},{default:o(()=>[r(n,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:t.value.email,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.email=a),maxLength:"150"},{prefix:o(()=>[te]),_:1},8,["modelValue"])]),_:1}),l.value==1?(p(),x(d,{key:0,prop:"password"},{default:o(()=>[r(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.password=a),"show-password":""},{prefix:o(()=>[re]),_:1},8,["modelValue"])]),_:1})):m("",!0),l.value==0||l.value==2?(p(),b("div",ie,[r(d,{prop:"emailCode"},{default:o(()=>[s("div",ne,[r(n,{size:"large",placeholder:"请输入邮箱验证码",modelValue:t.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.emailCode=a)},{prefix:o(()=>[de]),_:1},8,["modelValue"]),r(_,{class:"send-mail-btn",type:"primary",size:"large",onClick:T},{default:o(()=>[R("获取验证码")]),_:1})]),r(y,{placement:"left",width:500,trigger:"click"},{reference:o(()=>[ce]),default:o(()=>[ue]),_:1})]),_:1}),l.value==0?(p(),x(d,{key:0,prop:"nickName"},{default:o(()=>[r(n,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:t.value.nickName,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.nickName=a),maxLength:"20"},{prefix:o(()=>[pe]),_:1},8,["modelValue"])]),_:1})):m("",!0),r(d,{prop:"registerPassword"},{default:o(()=>[r(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:t.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.registerPassword=a),"show-password":""},{prefix:o(()=>[me]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"reRegisterPassword"},{default:o(()=>[r(n,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:t.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.reRegisterPassword=a),"show-password":""},{prefix:o(()=>[fe]),_:1},8,["modelValue"])]),_:1})])):m("",!0),r(d,{prop:"checkCode"},{default:o(()=>[s("div",ve,[r(n,{size:"large",placeholder:"请输入验证码",modelValue:t.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.checkCode=a),onKeyup:H(z,["enter"])},{prefix:o(()=>[_e]),_:1},8,["modelValue","onKeyup"]),s("img",{src:U.value,class:"check-code",onClick:e[7]||(e[7]=a=>w(0))},null,8,ge)])]),_:1}),l.value==1?(p(),x(d,{key:2},{default:o(()=>[s("div",ke,[r(K,{modelValue:t.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.rememberMe=a)},{default:o(()=>[R("记住我")]),_:1},8,["modelValue"])]),s("div",we,[s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[9]||(e[9]=a=>v(2))},"忘记密码？"),s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[10]||(e[10]=a=>v(0))},"没有账号？")])]),_:1})):m("",!0),l.value==0?(p(),x(d,{key:3},{default:o(()=>[s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[11]||(e[11]=a=>v(1))},"已有账号?")]),_:1})):m("",!0),l.value==2?(p(),x(d,{key:4},{default:o(()=>[s("a",{href:"javascript:void(0)",class:"a-link",onClick:e[12]||(e[12]=a=>v(1))},"去登录?")]),_:1})):m("",!0),r(d,null,{default:o(()=>[r(_,{type:"primary",class:"op-btn",onClick:z,size:"large"},{default:o(()=>[l.value==0?(p(),b("span",he,"注册")):m("",!0),l.value==1?(p(),b("span",Ce,"登录")):m("",!0),l.value==2?(p(),b("span",Ve,"重置密码")):m("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),r(O,{show:h.show,title:h.title,buttons:h.buttons,width:"500px",showCancel:!1,onClose:e[15]||(e[15]=a=>h.show=!1)},{default:o(()=>[r(D,{model:C.value,rules:S,ref_key:"formData4SendMailCodeRef",ref:q,"label-width":"80px"},{default:o(()=>[r(d,{label:"邮箱"},{default:o(()=>[R(J(t.value.email),1)]),_:1}),r(d,{label:"验证码",prop:"checkCode"},{default:o(()=>[s("div",ye,[r(n,{size:"large",placeholder:"请输入验证码",modelValue:C.value.checkCode,"onUpdate:modelValue":e[13]||(e[13]=a=>C.value.checkCode=a)},{prefix:o(()=>[be]),_:1},8,["modelValue"]),s("img",{src:I.value,class:"check-code",onClick:e[14]||(e[14]=a=>w(1))},null,8,xe)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},no=ee(Pe,[["__scopeId","data-v-405e0208"]]);export{no as default};
