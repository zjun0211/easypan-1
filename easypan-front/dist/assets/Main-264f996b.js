import{j as oe,r as c,ag as f,o as u,c as v,V as t,P as o,a3 as se,T as p,U as I,F as K,O as P,S as k,n as Y,b as ge,a as s,a9 as ae,Q as we,W as ke,J as be,u as Fe,bh as Ce,bf as Ne}from"./@vue-57ff52f9.js";import{u as Te}from"./vue-clipboard3-69020072.js";import{u as ie,b as Ie}from"./vue-router-8555237b.js";import{_ as Se}from"./index-ca90e5e8.js";import"./clipboard-0f4a3daa.js";import"./aplayer-585df14e.js";import"./pinia-00fcc55c.js";import"./spark-md5-66a43a5d.js";import"./element-plus-ef3483b5.js";import"./lodash-es-36eb724a.js";import"./@vueuse-7d05ada6.js";import"./@element-plus-b7409ee9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-5d216acc.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-9626137c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-880a26aa.js";import"./vue-cookies-fc2d14d9.js";import"./@highlightjs-b4f50377.js";import"./highlight.js-6845818c.js";import"./axios-4a70c6fc.js";import"./docx-preview-6a55e1c1.js";import"./jszip-057f312d.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-d49914df.js";import"./vue-60347265.js";import"./vue3-pdfjs-749e1b4f.js";import"./pdfjs-dist-dcaaa779.js";import"./dommatrix-b4915c8e.js";import"./web-streams-polyfill-ab743aaf.js";import"./dplayer-d4a41b2a.js";const xe={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jpeg,.jpg,.png,.gif,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Re={__name:"ShareFile",setup(V,{expose:A}){const{toClipboard:H}=Te(),{proxy:r}=oe();ie();const D=c(document.location.origin+"/share/"),Z={shareFile:"/share/shareFile"},_=c(0),m=c({}),$=c(),U={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请输入提取码"},{validator:r.Verify.shareCode,message:"提取码只能是数字字母"},{min:5,message:"提取码最少5位"}]},n=c(!0),b=c({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:g=>{J()}}]}),d=c({}),J=async()=>{if(Object.keys(d.value).length>0){b.value.show=!1;return}$.value.validate(async g=>{if(!g)return;let i={};Object.assign(i,m.value);let h=await r.Request({url:Z.shareFile,params:i});h&&(_.value=1,d.value=h.data,b.value.buttons[0].text="关闭",n.value=!1)})};A({show:g=>{n.value=!0,b.value.show=!0,_.value=0,d.value={},Y(()=>{$.value.resetFields(),m.value=Object.assign({},g)})}});const x=async()=>{await H(`链接:${D.value}${d.value.shareId} 提取码: ${d.value.code}`),r.Message.success("复制成功")};return(g,i)=>{const h=f("el-form-item"),N=f("el-radio"),F=f("el-radio-group"),M=f("el-input"),j=f("el-button"),Q=f("el-form"),W=f("Dialog");return u(),v("div",null,[t(W,{show:b.value.show,title:b.value.title,buttons:b.value.buttons,width:"600px",showCancel:n.value,onClose:i[4]||(i[4]=C=>b.value.show=!1)},{default:o(()=>[t(Q,{model:m.value,rules:U,ref_key:"formDataRef",ref:$,"label-width":"100px",onSubmit:i[3]||(i[3]=se(()=>{},["prevent"]))},{default:o(()=>[t(h,{label:"文件"},{default:o(()=>[p(I(m.value.fileName),1)]),_:1}),_.value==0?(u(),v(K,{key:0},[t(h,{label:"有效期",prop:"validType"},{default:o(()=>[t(F,{modelValue:m.value.validType,"onUpdate:modelValue":i[0]||(i[0]=C=>m.value.validType=C)},{default:o(()=>[t(N,{label:0},{default:o(()=>[p("1天")]),_:1}),t(N,{label:1},{default:o(()=>[p("7天")]),_:1}),t(N,{label:2},{default:o(()=>[p("30天")]),_:1}),t(N,{label:3},{default:o(()=>[p("永久有效")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"提取码",prop:"codeType"},{default:o(()=>[t(F,{modelValue:m.value.codeType,"onUpdate:modelValue":i[1]||(i[1]=C=>m.value.codeType=C)},{default:o(()=>[t(N,{label:0},{default:o(()=>[p("自定义")]),_:1}),t(N,{label:1},{default:o(()=>[p("系统生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),m.value.codeType==0?(u(),P(h,{key:0,prop:"code"},{default:o(()=>[t(M,{clearable:"",placeholder:"请输入5位提取码",modelValue:m.value.code,"onUpdate:modelValue":i[2]||(i[2]=C=>m.value.code=C),modelModifiers:{trim:!0},maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):k("",!0)],64)):(u(),v(K,{key:1},[t(h,{label:"分享连接",prop:"validType"},{default:o(()=>[p(I(D.value)+I(d.value.shareId),1)]),_:1}),t(h,{label:"提取码",prop:"validType"},{default:o(()=>[p(I(d.value.code),1)]),_:1}),t(h,{prop:"validType"},{default:o(()=>[t(j,{type:"primary",onClick:x},{default:o(()=>[p("复制链接极提取码")]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}};const S=V=>(Ce("data-v-917833c1"),V=V(),Ne(),V),Ve={class:"top"},De={class:"top-op"},$e={class:"btn"},Me=S(()=>s("span",{class:"iconfont icon-upload"},null,-1)),Ee=S(()=>s("span",{class:"iconfont icon-folder-add"},null,-1)),Oe=S(()=>s("span",{class:"iconfont icon-del"},null,-1)),ze=S(()=>s("span",{class:"iconfont icon-move"},null,-1)),Pe={class:"search-panel"},Ue={key:0,class:"file-list"},qe=["onMouseenter","onMouseleave"],je=["title"],Le=["onClick"],Be={key:0,class:"transfer-status"},Ke={key:1,class:"transfer-status transfer-fail"},Ae={class:"edit-panel"},He=["onClick"],Je=["onClick"],Qe={class:"op"},We=["onClick"],Ge=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze=["onClick"],el={key:0},ll={key:1,class:"no-data"},tl={class:"no-data-inner"},al=S(()=>s("div",{class:"tips"},"当前目录为空，上传你的第一个文件吧",-1)),ol={class:"op-list"},sl={class:"op-item"},il=S(()=>s("div",null,"上传文件",-1)),nl=S(()=>s("div",null,"新建目录",-1)),cl={__name:"Main",emits:["addFile"],setup(V,{expose:A,emit:H}){const{proxy:r}=oe();ie(),Ie();const D=async e=>{H("addFile",{file:e.file,filePid:E.value.fileId})};A({reload:()=>{x.value=!1,i()}});const _={loadDataList:"/file/loadDataList",rename:"/file/rename",newFoloder:"/file/newFoloder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},m=ge(()=>{const e=xe[g.value];return e?e.accept:"*"}),$=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],U=()=>{x.value=!0,i()},n=c({}),b={extHeight:50,selectType:"checkbox"},d=c([]),J=e=>{d.value=[],e.forEach(l=>{d.value.push(l.fileId)})},q=c(),x=c(!0),g=c(),i=async()=>{let e={pageNo:n.value.pageNo,pageSize:n.value.pageSize,fileNameFuzzy:q.value,category:g.value,filePid:E.value.fileId};e.category!=="all"&&delete e.filePid;let l=await r.Request({url:_.loadDataList,showLoading:x,params:e});l&&(n.value=l.data,F.value=!1)},h=e=>{n.value.list.forEach(l=>{l.showOp=!1}),e.showOp=!0},N=e=>{e.showOp=!1},F=c(!1),M=c(),j=()=>{F.value||(n.value.list.forEach(e=>{e.showEdit=!1}),F.value=!0,n.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:E.value.fileId}),Y(()=>{M.value.focus()}))},Q=e=>{n.value.list[0].fileId==""&&n.value.list.splice(0,1),n.value.list.forEach(w=>{w.showEdit=!1});let l=n.value.list[e];l.showEdit=!0,l.folderType==0?(l.fileNameReal=l.fileName.substring(0,l.fileName.indexOf(".")),l.fileSuffix=l.fileName.substring(l.fileName.indexOf("."))):(l.fileNameReal=l.fileName,l.fileSuffix=""),F.value=!0,Y(()=>{M.value.focus()})},W=e=>{const l=n.value.list[e];l.fileId?l.showEdit=!1:(n.value.list.splice(e,1),F.value=!1)},C=async e=>{const{fileId:l,filePid:w,fileNameReal:R}=n.value.list[e];if(R==""||R.indexOf("/")!=-1){r.Message.warning("文件名不能为空且不能含有斜杠");return}let z=_.rename;l==""&&(z=_.newFoloder);let B=await r.Request({url:z,params:{fileId:l,filePid:w,fileName:R}});B&&(n.value.list[e]=B.data,F.value=!1)},ee=c(),le=c(),ne=e=>{if(e.folderType==1){le.value.openFolder(e);return}if(e.status!=2){r.Message.warning("文件正在转码中，无法预览");return}ee.value.showPreview(e,0)},E=c({fileId:0}),ce=e=>{const{curFolder:l,categoryId:w}=e;E.value=l,x.value=!0,g.value=w,i()},L=c(),O=c({}),ue=e=>{O.value=e,L.value.showFolderDialog(e.fileId)},re=()=>{O.value={},L.value.showFolderDialog(d.value.join(","))},de=async e=>{if(O.value.filePid===e||E.value.fileId==e){r.Message.warning("文件正在当前目录，无需移动");return}let l=[];O.value.fileId?l.push(O.value.fileId):l=l.concat(d.value),await r.Request({url:_.changeFileFolder,params:{fileIds:l.join(","),filePid:e}})&&(L.value.close(),i())},fe=e=>{r.Confirm(`你确定要删除【${e.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await r.Request({url:_.delFile,params:{fileIds:e.fileId}})&&(i(),dataTableRef.value.clearSelection())})},pe=()=>{d.value.length!=0&&r.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await r.Request({url:_.delFile,params:{fileIds:d.value.join(",")}})&&i()})},me=async e=>{let l=await r.Request({url:_.createDownloadUrl+"/"+e.fileId});l&&(window.location.href=_.download+"/"+l.data)},te=c(),ve=e=>{te.value.show(e)};return(e,l)=>{const w=f("el-button"),R=f("el-upload"),z=f("el-input"),B=f("Navigation"),G=f("icon"),_e=f("Table"),X=f("Icon"),he=f("Preview"),ye=f("FolderSelect");return u(),v("div",null,[s("div",Ve,[s("div",De,[s("div",$e,[t(R,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":D,accept:m.value},{default:o(()=>[t(w,{type:"primary"},{default:o(()=>[Me,p(" 上传 ")]),_:1})]),_:1},8,["accept"])]),g.value=="all"?(u(),P(w,{key:0,type:"success",onClick:j},{default:o(()=>[Ee,p(" 新建文件夹 ")]),_:1})):k("",!0),t(w,{onClick:pe,type:"danger",disabled:d.value.length==0},{default:o(()=>[Oe,p(" 批量删除 ")]),_:1},8,["disabled"]),t(w,{onClick:re,type:"warning",disabled:d.value.length==0},{default:o(()=>[ze,p(" 批量移动 ")]),_:1},8,["disabled"]),s("div",Pe,[t(z,{clearable:"",placeholder:"输入文件名搜索",modelValue:q.value,"onUpdate:modelValue":l[0]||(l[0]=T=>q.value=T),onKeyup:ae(U,["enter"])},{suffix:o(()=>[s("i",{class:"iconfont icon-search",onClick:U})]),_:1},8,["modelValue","onKeyup"])]),s("div",{class:"iconfont icon-refresh",onClick:i})]),t(B,{ref_key:"navigationRef",ref:le,onNavChange:ce},null,512)]),n.value.list&&n.value.list.length>0?(u(),v("div",Ue,[t(_e,{ref:"dataTableRef",columns:$,showPagination:!0,dataSource:n.value,fetch:i,initFetch:!1,options:b,onRowSelected:J},{fileName:o(({index:T,row:a})=>[s("div",{class:"file-item",onMouseenter:y=>h(a),onMouseleave:y=>N(a)},[(a.fileType==3||a.fileType==1)&&a.status==2?(u(),P(G,{key:0,cover:a.fileCover,width:32},null,8,["cover"])):(u(),v(K,{key:1},[a.folderType==0?(u(),P(G,{key:0,fileType:a.fileType},null,8,["fileType"])):k("",!0),a.folderType==1?(u(),P(G,{key:1,fileType:0})):k("",!0)],64)),a.showEdit?k("",!0):(u(),v("span",{key:2,class:"file-name",title:a.fileName},[s("span",{onClick:y=>ne(a)},I(a.fileName),9,Le),a.status==0?(u(),v("span",Be,"转码中")):k("",!0),a.status==1?(u(),v("span",Ke,"转码失败")):k("",!0)],8,je)),we(s("div",Ae,[t(z,{modelValue:a.fileNameReal,"onUpdate:modelValue":y=>a.fileNameReal=y,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:M,maxLength:190,onKeyup:ae(y=>C(T),["enter"])},{suffix:o(()=>[p(I(a.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),s("span",{class:be(["iconfont icon-right1",a.fileNameReal?"":"not-allow"]),onClick:y=>C(T)},null,10,He),s("span",{class:"iconfont icon-error",onClick:y=>W(T)},null,8,Je)],512),[[ke,a.showEdit]]),s("span",Qe,[a.showOp&&a.fileId&&a.status==2?(u(),v(K,{key:0},[s("span",{class:"iconfont icon-share1",onClick:y=>ve(a)},"分享",8,We),a.folderType==0?(u(),v("span",{key:0,class:"iconfont icon-download",onClick:y=>me(a)},"下载",8,Ge)):k("",!0),s("span",{class:"iconfont icon-del",onClick:y=>fe(a)},"删除",8,Xe),s("span",{class:"iconfont icon-edit",onClick:se(y=>Q(T),["stop"])},"重命名",8,Ye),s("span",{class:"iconfont icon-move",onClick:y=>ue(a)},"移动",8,Ze)],64)):k("",!0)])],40,qe)]),fileSize:o(({index:T,row:a})=>[a.fileSize?(u(),v("span",el,I(Fe(r).Utils.sizeToStr(a.fileSize)),1)):k("",!0)]),_:1},8,["dataSource"])])):(u(),v("div",ll,[s("div",tl,[t(X,{iconName:"no_data",width:120,fit:"fill"}),al,s("div",ol,[t(R,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":D,accept:m.value},{default:o(()=>[s("div",sl,[t(X,{iconName:"file",width:60}),il])]),_:1},8,["accept"]),g.value=="all"?(u(),v("div",{key:0,class:"op-item",onClick:j},[t(X,{iconName:"folder",width:60}),nl])):k("",!0)])])])),t(he,{ref_key:"previewRef",ref:ee},null,512),t(ye,{ref_key:"folderSelectRef",ref:L,onFolderSelect:de},null,512),t(Re,{ref_key:"shareRef",ref:te},null,512)])}}},Bl=Se(cl,[["__scopeId","data-v-917833c1"]]);export{Bl as default};
