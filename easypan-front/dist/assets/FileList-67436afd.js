import{j as J,r,ag as u,o as a,c as i,a as s,V as f,P as h,a9 as R,T as z,O as C,F as V,S as n,U as S,J as G,u as Q,bh as W,bf as X}from"./@vue-57ff52f9.js";import{u as Y,b as Z}from"./vue-router-8555237b.js";import{_ as ee}from"./index-ca90e5e8.js";import"./pinia-00fcc55c.js";import"./spark-md5-66a43a5d.js";import"./aplayer-585df14e.js";import"./element-plus-ef3483b5.js";import"./lodash-es-36eb724a.js";import"./@vueuse-7d05ada6.js";import"./@element-plus-b7409ee9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-5d216acc.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-9626137c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-880a26aa.js";import"./vue-cookies-fc2d14d9.js";import"./@highlightjs-b4f50377.js";import"./highlight.js-6845818c.js";import"./axios-4a70c6fc.js";import"./docx-preview-6a55e1c1.js";import"./jszip-057f312d.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-d49914df.js";import"./vue-60347265.js";import"./vue3-pdfjs-749e1b4f.js";import"./pdfjs-dist-dcaaa779.js";import"./dommatrix-b4915c8e.js";import"./web-streams-polyfill-ab743aaf.js";import"./dplayer-d4a41b2a.js";import"./vue-clipboard3-69020072.js";import"./clipboard-0f4a3daa.js";const te=y=>(W("data-v-9e1423be"),y=y(),X(),y),oe={class:"top"},se={class:"top-op"},ae={class:"search-panel"},le=te(()=>s("span",{class:"iconfont icon-del"},null,-1)),ie={class:"file-list"},ne=["onMouseenter","onMouseleave"],ce=["title"],re=["onClick"],de={key:0,class:"transfer-status"},pe={key:1,class:"transfer-status transfer-fail"},ue={key:3,class:"edit-panel"},fe=["onClick"],me=["onClick"],_e={class:"op"},ve=["onClick"],he=["onClick"],ye={key:0},ke={__name:"FileList",emits:["addFile"],setup(y,{expose:x,emit:ge}){const{proxy:c}=J();Y(),Z(),x({reload:()=>{k.value=!1,d()}});const m={loadDataList:"/admin/loadFileList",delFile:"/admin/delFile",createDownloadUrl:"/admin/createDownloadUrl",download:"/api/admin/download"},L=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"发布人",prop:"nickName",width:250},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],b=()=>{k.value=!0,d()},_=r({}),U={extHeight:50,selectType:"checkbox"},v=r([]),$=t=>{v.value=[],t.forEach(o=>{v.value.push(o.userId+"_"+o.fileId)})},g=r(),k=r(!0),d=async()=>{let t={pageNo:_.value.pageNo,pageSize:_.value.pageSize,fileNameFuzzy:g.value,filePid:T.value.fileId},o=await c.Request({url:m.loadDataList,showLoading:k,params:t});o&&(_.value=o.data)},D=t=>{_.value.list.forEach(o=>{o.showOp=!1}),t.showOp=!0},E=t=>{t.showOp=!1},F=r(),I=r(),O=t=>{if(t.folderType==1){I.value.openFolder(t);return}if(t.status!=2){c.Message.warning("文件正在转码中，无法预览");return}F.value.showPreview(t,1)},T=r({fileId:0}),M=t=>{const{curFolder:o}=t;T.value=o,k.value=!0,d()},P=t=>{c.Confirm(`你确定要删除【${t.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await c.Request({url:m.delFile,params:{fileIdAndUserIds:t.userId+"_"+t.fileId}})&&d()})},B=()=>{v.value.length!=0&&c.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await c.Request({url:m.delFile,params:{fileIdAndUserIds:v.value.join(",")}})&&d()})},K=async t=>{let o=await c.Request({url:m.createDownloadUrl+"/"+t.userId+"/"+t.fileId});o&&(window.location.href=m.download+"/"+o.data)};return r(),(t,o)=>{const w=u("el-input"),q=u("el-button"),j=u("Navigation"),N=u("icon"),A=u("Table"),H=u("Preview");return a(),i("div",null,[s("div",oe,[s("div",se,[s("div",ae,[f(w,{clearable:"",placeholder:"输入文件名搜索",modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=p=>g.value=p),onKeyup:R(b,["enter"])},{suffix:h(()=>[s("i",{class:"iconfont icon-search",onClick:b})]),_:1},8,["modelValue","onKeyup"])]),s("div",{class:"iconfont icon-refresh",onClick:d}),f(q,{style:{"margin-left":"10px"},type:"danger",disabled:v.value.length==0,onClick:B},{default:h(()=>[le,z(" 批量删除 ")]),_:1},8,["disabled"])]),f(j,{ref_key:"navigationRef",ref:I,onNavChange:M,adminShow:!0},null,512)]),s("div",ie,[f(A,{columns:L,showPagination:!0,dataSource:_.value,fetch:d,initFetch:!1,options:U,onRowSelected:$},{fileName:h(({index:p,row:e})=>[s("div",{class:"file-item",onMouseenter:l=>D(e),onMouseleave:l=>E(e)},[(e.fileType==3||e.fileType==1)&&e.status==2?(a(),C(N,{key:0,cover:e.fileCover,width:32},null,8,["cover"])):(a(),i(V,{key:1},[e.folderType==0?(a(),C(N,{key:0,fileType:e.fileType},null,8,["fileType"])):n("",!0),e.folderType==1?(a(),C(N,{key:1,fileType:0})):n("",!0)],64)),e.showEdit?n("",!0):(a(),i("span",{key:2,class:"file-name",title:e.fileName},[s("span",{onClick:l=>O(e)},S(e.fileName),9,re),e.status==0?(a(),i("span",de,"转码中")):n("",!0),e.status==1?(a(),i("span",pe,"转码失败")):n("",!0)],8,ce)),e.showEdit?(a(),i("div",ue,[f(w,{modelValue:e.fileNameReal,"onUpdate:modelValue":l=>e.fileNameReal=l,modelModifiers:{trim:!0},maxLength:190,onKeyup:R(l=>t.saveNameEdit(p),["enter"])},{suffix:h(()=>[z(S(e.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),s("span",{class:G(["iconfont icon-right1",e.fileNameReal?"":"not-allow"]),onClick:l=>t.saveNameEdit(p)},null,10,fe),s("span",{class:"iconfont icon-error",onClick:l=>t.cancelNameEdit(p)},null,8,me)])):n("",!0),s("span",_e,[e.showOp&&e.fileId?(a(),i(V,{key:0},[e.folderType==0?(a(),i("span",{key:0,class:"iconfont icon-download",onClick:l=>K(e)},"下载",8,ve)):n("",!0),s("span",{class:"iconfont icon-del",onClick:l=>P(e)},"删除",8,he)],64)):n("",!0)])],40,ne)]),fileSize:h(({index:p,row:e})=>[e.fileSize?(a(),i("span",ye,S(Q(c).Utils.sizeToStr(e.fileSize)),1)):n("",!0)]),_:1},8,["dataSource"])]),f(H,{ref_key:"previewRef",ref:F},null,512)])}}},ot=ee(ke,[["__scopeId","data-v-9e1423be"]]);export{ot as default};
